\chapter{Μεθοδολογία}\label{chap:methodology}

Στο παρόν κεφάλαιο περιγράφεται το σύστημα ανάλυσης ρομποτικών εντολών \projectname{} που αναπτύχθηκε στο πλαίσιο αυτής της διπλωματικής εργασίας.
Ο κώδικας του συστήματος βρίσκεται στο \url{https://github.com/robotics-4-all/2017_B_NLP_robotics}.
Είναι γραμμένος σε \en{Python 3.7}\footnote{\url{https://www.python.org/}} (μπορεί να τρέξει και σε \en{Python 3.6} με μικρές τροποποιήσεις)
και \en{Bash}\footnote{\url{https://www.gnu.org/software/bash/}}.
Για την τεκμηρίωση του συστήματος χρησιμοποιείται \LaTeX{}\footnote{\url{https://www.latex-project.org/}} και \en{Markdown}\footnote{\url{https://daringfireball.net/projects/markdown/}}.

\section{Βιβλιοθήκες}
\newcommand{\libitem}[2][]{%
    \begingroup%
    \let\lib\enbfttt%
    \item\libcite[#1]{#2}:%
    \endgroup%
}%
Διάφορες βιβλιοθήκες ανοιχτού λογισμικού χρησιμοποιήθηκαν για την υλοποίηση της παρούσας διπλωματικής.
Αναφέρονται σε αυτή την ενότητα συγκεντρωτικά και θα γίνεται πιο συγκεκριμένη αναφορά όπου κρίνεται απαραίτητο.
\begin{compactitem}
    \libitem{CoreNLP} Εργαλειοθήκη επεξεργασίας φυσικής γλώσσας του \en{Stanford}, γραμμένη σε \en{Java}.
    Προσφέρει διάφορα εργαλεία για την επεξεργασία και ανάλυση φυσικής γλώσσας και εμπεριέχει διάφορα μοντέλα που επιλύουν προβλήματα πέραν των βασικών.
    \libitem[Python!]{spaCy} Βιβλιοθήκη επεξεργασίας φυσικής γλώσσας σε \en{Python}, σχεδιασμένη με στόχο κυρίως την επαγγελματική χρήση.
    Παρέχει υπολογιστικά αποδοτικές λύσεις για διάφορες βασικές λειτουργίες στην επεξεργασία φυσικής γλώσσας.
    \libitem[Python!]{Snips} Πλατφόρμα δημιουργίας ψηφιακών βοηθών σε \en{Python}.
    Βλέπε και σχήμα \ref{fig:snips} στη σελίδα~\pageref{fig:snips}.
    \libitem[Python!]{neuralcoref} Επέκταση για τη \en{spaCy} που πραγματοποιεί επίλυση συναναφορών.
    \libitem[Python!]{AllenNLP} Ερευνητική βιβλιοθήκη επεξεργασίας φυσικής γλώσσας σε \en{Python}.
    Προσφέρει μοντέλα που επιλύουν δύσκολα προβλήματα επεξεργασίας και κατανόησης φυσικής γλώσσας.
    Συνήθως βασίζονται σε αρχιτεκτονικές νευρωνικών δικτύων.
    \libitem[Python!]{DeepPavlov} Πλατφόρμα δημιουργίας ψηφιακών βοηθών που βασίζεται στη χρήση βαθιών νευρωνικών δικτύων σε \en{Python}.
    \libitem[Python!]{PyEcore} Υλοποίηση της πλατφόρμας μοντελοποίησης του Eclipse (\en{Eclipse Modeling Framework - EMF}) σε \en{Python}.
    \libitem[Python!]{networkx} Βιβλιοθήκη δημιουργίας γράφων και δικτύων σε \en{Python}.
    \libitem[Python!]{matplotlib} Βιβλιοθήκη σχεδίασης δισδιάστατων γραφημάτων με λειτουργία παρόμοια της αντίστοιχης βιβλιοθήκης του \en{MATLAB} σε \en{Python}.
    \libitem{Graphviz} Λογισμικό για την απεικόνιση γράφων.
    \libitem[Python!]{requests} Βιβλιοθήκη της \en{Python} που πραγματοποιεί \newtermprint[Requests]{Αιτήσεις} χρησιμοποιώντας το πρωτόκολλο HTTP.
    \libitem[Python!]{braceexpand} Βιβλιοθήκη της \en{Python} που επεκτείνει χαρακτήρες που περιέχονται μέσα σε μια ομάδα αγκίστρων.
\end{compactitem}

\section{Γραφική γλώσσα \metamodel{}}
Κατά την αναγνώριση των ενεργειών και οντοτήτων που περιλαμβάνονται μέσα στο κείμενο ενός χρήστη απαιτείται η ύπαρξη ενός προκαθορισμένου συνόλου που τις περιλαμβάνει
(βλέπε και ενότητες \ref{sec:problem-description} και \ref{sec:diploma-purpose}).
Για τον σκοπό αυτό, χρησιμοποιήθηκε η γραφική γλώσσα \metamodel{}\footnote{\url{https://r4a.issel.ee.auth.gr/nao4a/}} και το σχετικό μέτα-μοντέλο.

Στόχος της γλώσσας αποτελεί η ανάπτυξη εφαρμογών για το ρομπότ NAO\footnote{\url{https://www.softbankrobotics.com/emea/en/nao}}.
Πρόκειται για ένα ανθρωπόμορφο ρομπότ ύψους 58 εκατοστών σχεδιασμένο από τη \en{Softbank Robotics}.
Διαθέτει πολλούς αισθητήρες και κινητήρες που του δίνουν ελευθερία κινήσεων και τη δυνατότητα να αλληλεπιδρά με το περιβάλλον του.
Ένα σχηματικό διάγραμμα δίνεται στο \fref{fig:nao}.
\ig[type=pdf,inc={width=0.7\linewidth}]{nao}{\caption{Διάγραμμα του ρομπότ NAO}}

Το εργαλείο αυτό αναπτύχθηκε από την ομάδα \en{Robotics 4 All (R4A)}\footnote{\url{https://r4a.issel.ee.auth.gr}}
του Τμήματος Ηλεκτρολόγων Μηχανικών και Μηχανικών Υπολογιστών του Αριστοτελείου Πανεπιστημίου Θεσσαλονίκης.
Έχει στόχο τη διευκόλυνση της ανάπτυξης ρομποτικών εφαρμογών με τη χρήση ενός απλού γραφικού περιβάλλοντος μέσα από το
\newtermprint[Integrated Development Environment - IDE]{Ολοκληρωμένο Περιβάλλον Ανάπτυξης} \en{Eclipse}\footnote{\url{https://www.eclipse.org/}}.
Το περιβάλλον αυτό, μαζί με ένα παράδειγμα ενδεικτικής ρομποτικής εφαρμογής, παρουσιάζεται στο \fref{fig:4-loop}.

Βασίζεται σε μοντελοστραφείς τεχνικές ανάπτυξης λογισμικού και παράγει τον κατάλληλο κώδικα \en{Python} για το λειτουργικό σύστημα \en{NAOqi} με βάση τον γράφο που δημιουργεί ο χρήστης.
Κάθε κόμβος αναπαριστά μία συμπεριφορά του ρομπότ.
Αυτές συνδέονται μεταξύ τους με τις σωστές μεταβάσεις.
Μια συνοπτική παρουσίαση του μέτα-μοντέλου φαίνεται στο \fref{fig:metamodel}.

\ig[pos=t,type=png,inc={width=\linewidth}]{4-loop}{\lcaption{Παράδειγμα χρήσης γραφικής γλώσσας \metamodel{} με βρόχο επανάληψης}{%
        Κατά την εκτέλεση αυτής της εφαρμογής, το NAO θα προχωρήσει ευθεία, διατηρώντας την αρχική του κατεύθυνση, μέχρι να ανιχνεύσει την ύπαρξη ανθρώπου.
        Αφού ανιχνεύσει κάποιον άνθρωπο, θα εκφωνήσει \engquote{I found you!} και θα τερματίσει τη λειτουργία του.
        Η διάρκεια ανίχνευσης διαρκεί πέντε δευτερόλεπτα.
        Κάθε φορά που το NAO αποτυγχάνει να ανιχνεύσει κάποιον, εκφωνεί \engquote{Where are you?}
    }%
}

\ig[pos=t,type=png,inc={width=\linewidth}]{metamodel}{\caption{Το μέτα-μοντέλο \metamodel{}}}

\subsection{Ενέργειες του ρομπότ NAO}
\newcommand{\defintent}[2][]{\def\tmp{#2}%
    \ifthenelse{\isempty{#1}}{%
        \lowercase{\def\tmpurlhash{#2}}%
    }{%
        \lowercase{\def\tmpurlhash{#1}}%
    }%
    \def\tmpurl{https://r4a.issel.ee.auth.gr/nao4a/\#\tmpurlhash}%
    \StrDel{\tmp}{ }[\tmp]%
    \StrDel{\tmpurl}{ }[\tmpurl]%
    \hypersetup{urlcolor=black}% Assuming inside group since we call \item
    \item\href{\tmpurl}{\textbf{#2}}\label{intent:\tmp}:}
Οι ενέργειες που υποστηρίζει η \metamodel{} παρατίθενται στη συνέχεια.
Κάθε ενέργεια επίσης παραμετροποιείται με διάφορες ιδιότητες που δεν αναφέρονται εδώ για συντομία.

\subsubsection{Ενέργειες Κίνησης}
\begin{compactitem}
    \defintent{Head Motion} Ο χρήστης μπορεί να κινήσει το κεφάλι του NAO σε μία από τις πέντε θέσεις: αριστερά, δεξιά, πάνω, κάτω, επιστροφή στην ουδέτερη θέση.
    \defintent{Body Motion} Ο χρήστης μπορεί να κινήσει το NAO ως σύνολο δίνοντάς του παραμέτρους για την κατεύθυνση, την απόσταση ή τη διάρκεια της κίνησης, την ταχύτητα και την ελάχιστη απόσταση από εμπόδια.
    \defintent{Arm Motion} Ο χρήστης μπορεί να κινήσει το ένα ή και τα δύο χέρια του ρομπότ δηλώνοντας τον τύπο της κίνησης.
    \defintent{Body Stance} Ο χρήστης μπορεί να επιλέξει τη στάση που θα πάρει το ρομπότ.
    \defintent{Learn Motion} Ο χρήστης μπορεί να μάθει στο NAO μία νέα κίνηση, κινώντας τις αρθρώσεις όπως επιθυμεί και δίνοντάς της ένα όνομα.
    \defintent{Replay Motion} Το ρομπότ μπορεί να αναπαραγάγει μία κίνηση που έμαθε προηγουμένως από τον χρήστη χρησιμοποιώντας το όνομα που της δόθηκε.
\end{compactitem}

\subsubsection{Αλληλεπίδραση με τον χρήστη}
\begin{compactitem}
    \defintent{Detect Touch} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να αναγνωρίσει άγγιγμα σε κάποιο μέρος ή μέρη του σώματός του.
    \defintent{Detect Human} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να αναγνωρίσει την ύπαρξη ανθρώπινου προσώπου.
    \defintent{Detect Sound} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να αντιληφθεί την ύπαρξη ήχου.
    \defintent{Detect Motion} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να αναγνωρίσει την ύπαρξη κίνησης.
    \defintent{Listen} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να ακούσει ομιλία και να αναγνωρίσει τι είπε ο χρήστης από μία λίστα εκφράσεων.
    \defintent{Record Sound} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να καταγράψει ήχο από το περιβάλλον του για μία συγκεκριμένη διάρκεια.
    \defintent{Replay Sound} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να αναπαράγει κάποιον ήχο που κατέγραψε σε προηγούμενη φάση.
    \defintent{Weather Report} Ο χρήστης μπορεί να ρυθμίσει το ρομπότ ώστε αυτό να είναι έτοιμο να αναφέρει τις καιρικές συνθήκες για μία πόλη από το σύνολο που ορίζει ο χρήστης χρησιμοποιώντας πληροφορίες από το διαδίκτυο.
\end{compactitem}

\subsubsection{Λοιπές Ενέργειες}
\begin{compactitem}
    \defintent{Talk} Ο χρήστης μπορεί να καταχωρήσει μία φράση την οποία θα εκφωνήσει το NAO.
    \defintent{Dice} Δίνει τη δυνατότητα μετάβασης σε μία ενέργεια από ένα σύνολο ενεργειών με τυχαίο τρόπο.
    \defintent{Sleep} Θέτει την εφαρμογή ή μέρος αυτής σε κατάσταση αναμονής για κάποιο χρονικό διάστημα.
    \defintent[ledon]{Turn Led On} Ο χρήστης μπορεί να επιλέξει ποια LEDs θα ενεργοποιηθούν και ποιο χρώμα θα λάβουν.
    \defintent[ledoff]{Turn Led Off} Ο χρήστης μπορεί να επιλέξει ποια LEDs θα απενεργοποιηθούν.
    \defintent{Counter} Ο χρήστης μπορεί να δημιουργήσει ακέραιους μετρητές ή συγκριτές.
\end{compactitem}

\section{Δεδομένα εκπαίδευσης}
Για τα διάφορα μοντέλα μηχανικής μάθησης που χρησιμοποιήθηκαν στο \projectname{} δεν απαιτούνται δεδομένα εκπαίδευσης καθώς επιλύουν γενικά προβλήματα και είναι ήδη εκπαιδευμένα.
Εξαίρεση αποτελούν αυτά που βρίσκονται στη μονάδα \NLU{} που χρειάζεται να προσαρμοστούν πάνω στο συγκεκριμένο στόχο της διπλωματικής.
Για την εκπαίδευση τους δημιουργήθηκε ένα νέο σύνολο δεδομένων με προτάσεις που αντιστοιχούν σε κάθε ενέργεια του \metamodel{}.

Το σύνολο δεδομένων αποτελείται από δύο αρχεία ανά πρόθεση.
Το όνομα του πρώτου είναι της μορφής \mintinline{text}{intent_<IntentName>.yaml}\footnote{Χρησιμοποιείται η γλώσσα \lib{YAML} --- \url{https://yaml.org/}}
και περιλαμβάνει τις πληροφορίες που συνδέονται με τη κάθε πρόθεση, όπως το όνομά, τους υποδοχείς που δέχεται και τον τύπο της οντότητάς τους.
Ο τρόπος συγγραφής αυτών των πληροφοριών καθορίζεται από τη βιβλιοθήκη κατανόησης φυσικής γλώσσας \libcite[Python!]{Snips}\footnote{Περιγράφεται στο \url{https://snips-nlu.readthedocs.io/en/latest/dataset.html}},
ένα παράδειγμα παρουσιάζεται στη \fref{lst:intent-yaml}.

Το δεύτερο αρχείο παίρνει όνομα της μορφής \mintinline{text}{utterances_<IntentName>} και περιλαμβάνει παραδείγματα προτάσεων.
Σε κάθε πρόταση χρησιμοποιείται μόνο μια πιθανή ενέργεια (πρόθεση) καθώς η \lib{Snips} δεν υποστηρίζει πολλαπλές προθέσεις ανά πρόταση και η μεθοδολογία που ακολουθείται από το \projectname{} δεν απαιτεί την ύπαρξη τέτοιων προτάσεων στο σύνολο δεδομένων.

Επειδή η δημιουργία ενός συνόλου που καλύπτει όλα τα σενάρια χρήσης με αρκετή ποικιλομορφία στα κείμενα εισόδου αποτελεί απαιτητική διαδικασία,
τα δεδομένα εκπαίδευσης δεν είναι το κύριο επίκεντρο αυτής της εργασίας και για αυτό δεν είναι διεξοδικά.
Ωστόσο, για την ενίσχυσή του χρησιμοποιήθηκε η βιβλιοθήκη \libcite[Python!]{braceexpand} που επεκτείνει χαρακτήρες που βρίσκονται μέσα σε μια ομάδα αγκίστρων\footnote{\url{https://rosettacode.org/wiki/Brace_expansion} για παραδείγματα με υλοποιήσεις σε διάφορες γλώσσες προγραμματισμού}.
Για παράδειγμα, η ακολουθία \mintinline[]{text}|It{{em,alic}iz,erat}e{d,}| μετατρέπεται σε μία λίστα με τα εξής στοιχεία:
\mintinline[]{text}|Itemized|,
\mintinline[]{text}|Itemize|,
\mintinline[]{text}|Italicized|,
\mintinline[]{text}|Italicize|,
\mintinline[]{text}|Iterated|,
\mintinline[]{text}|Iterate|.
Κάθε ένας από τους συνδυασμούς που επεκτείνονται χρησιμοποιείται ως ξεχωριστό δεδομένο εκπαίδευσης.
Ένα παράδειγμα της μορφής αυτών των προτάσεων παρουσιάζεται στη \fref{lst:utterances}.

\begin{listing}
    \inputminted{yaml}{../data/intent_ArmMotionOpen.yaml}
    \caption[Δήλωση της πρόθεσης \texttt{ArmMotionOpen}]{Δήλωση της πρόθεσης \intent{ArmMotionOpen}.
        Σημειώνεται ότι η \intent{ArmMotionOpen} δεν αποτελεί ξεχωριστή ενέργεια του \metamodel{} αλλά είναι η \intent{ArmMotion} με \entity{armMotion=OPEN}.
        Αυτή η διάσπαση αναφέρεται στην \fref{subsec:4-snips}.%
    }\label{lst:intent-yaml}
    \inputminted{text}{../data/utterances_ArmMotionOpen}
    \caption[Δεδομένα εκπαίδευσης για τη πρόθεση \texttt{ArmMotionOpen}]{Δεδομένα εκπαίδευσης για τη πρόθεση \intent{ArmMotionOpen}.
        Χρησιμοποιούνται διάφορα ρήματα που αντιστοιχούν σε αυτή την ενέργεια και, όπου είναι δυνατό, ομαδοποιούνται σε αγκύλες.%
    }\label{lst:utterances}
\end{listing}

\section{Μονάδες} % TODO: mention optional
Το~\fref{fig:system} παρουσιάζει συνοπτικά τη σωλήνωση λογισμικού που αναπτύχθηκε.
Στις επόμενες ενότητες θα αναλυθεί η λειτουργία της κάθε μονάδας και η μεθοδολογία που χρησιμοποιήθηκε για την υλοποίησή της και την ενσωμάτωσή της με τις υπόλοιπες.
\ig[type=tikz]{system}{\caption{Σύνοψη συστήματος \projectname{}}}

\subsection{Επισήμανση παραθέσεων}\label{subsec:4-QuoteAnnotator}
\newcommand{\QUOTESTRING}{\engquote{\texttt{QUOTE}}}
Η πρώτη διεργασία που πραγματοποιείται κατά την είσοδο του κειμένου είναι η εύρεση και αντικατάσταση παραθέσεων.
Δηλαδή, το κείμενο που περιλαμβάνεται μέσα σε εισαγωγικά~(\texttt{"}) αντικαθίσταται με το αλφαριθμητικό \QUOTESTRING{}.

Γίνεται η υπόθεση ότι όλες οι παραθέσεις του κειμένου σε ευθύ λόγο ορθά εμπεριέχονται μέσα σε χαρακτήρες εισαγωγικών.

Για την ανίχνευση του διαστήματος των παραθέσεων μέσα στο κείμενο, χρησιμοποιείται ο \lib{QuoteAnnotator}\footnote{\url{https://stanfordnlp.github.io/CoreNLP/quote.html}} (υπομνηματιστής παραθέσεων) του \libcite{CoreNLP}.
Η λειτουργία της συγκεκριμένης μονάδας είναι ντετερμινιστική αντί να βασίζεται σε στατιστικές μεθόδους επεξεργασίας φυσικής γλώσσας.
Παραθέσεις που είναι διατυπωμένες σε πλάγιο λόγο δεν ανιχνεύονται από τον \lib{QuoteAnnotator}.

Η διαδικασία αποσκοπεί στη διευκόλυνση των επόμενων μοντέλων που πραγματοποιούν κάποια μορφή σημασιολογικής ανάλυσης
και για να αποφεύγεται η επεξεργασία του κειμένου που περιλαμβάνεται μέσα στα εισαγωγικά καθώς αυτό μεταφέρεται αυτολεξεί στην έξοδο του μοντέλου.

Τα αλφαριθμητικά \QUOTESTRING{} αντικαθιστώνται με το αρχικό κείμενο στην έξοδο του μοντέλου και στις τιμές των οντοτήτων στη μονάδα NLU (βλέπε \fref{subsec:4-NLU}).

\begin{code}
    \begin{minted}{json}
{
    "quotes": [
        {
            "id": 0,
            "text": "\"hello Alice\"",
            "beginIndex": 9,
            "endIndex": 22,
            "beginToken": 2,
            "endToken": 5,
            "beginSentence": 0,
            "endSentence": 0,
            "speaker": "Unknown",
            "canonicalSpeaker": "Unknown"
        }
    ]
}
    \end{minted}
    \lcaption{Παράδειγμα εξόδου \lib{QuoteAnnotator} σε \en{JSON}}{%
        Είσοδος: \engquote{\texttt{Bob said "hello Alice" and left}}.
        Η δυνατότητα ανίχνευσης ομιλητή απενεργοποιήθηκε για αυτό το παράδειγμα.%
    }
\end{code}

\subsection{\lib{SpaCy}}\label{subsec:4-spacy}
Η βιβλιοθήκη επεξεργασίας φυσικής γλώσσας \libcite[Python!]{spaCy} αποτελεί κεντρικό παράγοντα του \projectname{} αλλά και αρκετών άλλων βιβλιοθηκών από τις οποίες εξαρτάται.
Προσφέρει στατιστικά μοντέλα για διάφορες γλώσσες\footnote{\url{https://spacy.io/usage/models\#languages}} που χρησιμοποιούνται για την επισημείωση γλωσσολογικών χαρακτηριστικών σε σώματα κειμένου.
Παρέχει μια ποικιλία γλωσσικών επισημειώσεων που δίνουν εικόνες σχετικές με τη γραμματική δομή ενός κειμένου.
Αυτή περιλαμβάνει τους τύπους λέξεων, όπως τα μέρη του λόγου, και πώς οι λέξεις σχετίζονται μεταξύ τους.

Η χρήση της βιβλιοθήκης επικεντρώνεται γύρω από τρία βασικά αντικείμενα:
\begin{compactenum}
    \item Το αντικείμενο \python{Token} που είναι μια βασική λεκτική μονάδα --- μπορεί να περιέχει κάποια λέξη, ένα σημείο στίξης, κενό διάστημα κτλ.
    \item Το αντικείμενο \python{Slice} που είναι ένα τμήμα ενός \python{Doc} και περιλαμβάνει ένα συνεχές υποσύνολο από τα \python{Token} που ανήκουν σε αυτό.
    \item Το αντικείμενο εγγράφου \python{Doc} που αποτελείται από μια σειρά από \python{Token}.
          Μπορεί να χρησιμοποιηθεί, μεταξύ άλλων, για την πρόσβαση στις προτάσεις και τις οντότητες του κειμένου.
          Παρόλο που ένα αντικείμενο εγγράφου (\python{Doc}) υποβάλλεται σε επεξεργασία ---
          π.χ.\ χωρίζεται σε μεμονωμένες λέξεις και επισημειώνεται ---
          εξακολουθεί να διατηρεί όλες τις πληροφορίες του αρχικού κειμένου,
          όπως για παράδειγμα τους χαρακτήρες λευκού διαστήματος, επιτρέποντας την ανάκτησή του.
\end{compactenum}
Τα \python{Span} και \python{Token} αποτελούν \newtermprint[Views]{όψεις} των δεδομένων που αποθηκεύονται στο \python{Doc}.
Ένα παράδειγμα χρήσης παρουσιάζεται στην \fref{lst:spacy}.

\begin{listing}
    \begin{minted}{python}
>>> import spacy
>>> nlp = spacy.load("en_core_web_sm")  # Φόρτωση μικρού μοντέλου αγγλικών
>>> doc = nlp("Hello, world. Here are two sentences.")  # αντικείμενο Doc
>>> # Σειριακή πρόσβαση στις λεκτικές μονάδες (for t in doc)
>>> # και ανάγνωση ετικετών μερών του λόγου (t.pos_, t.tag_)
>>> # και συντακτικών εξαρτήσεων (t.dep_)
>>> [(t.text, t.pos_, t.tag_, t.dep_) for t in doc]
[('Hello', 'INTJ', 'UH', 'ROOT'),
 (',', 'PUNCT', ',', 'punct'),
 ('world', 'NOUN', 'NN', 'npadvmod'),
 ('.', 'PUNCT', '.', 'punct'),
 ('Here', 'ADV', 'RB', 'advmod'),
 ('are', 'VERB', 'VBP', 'ROOT'),
 ('two', 'NUM', 'CD', 'nummod'),
 ('sentences', 'NOUN', 'NNS', 'nsubj'),
 ('.', 'PUNCT', '.', 'punct')]
>>> # Αποτέλεσμα αποσαφήνισης ορίων πρότασης
>>> [t.text for t in doc.sents]
['Hello, world.', 'Here are two sentences.']
\end{minted}
    \caption{Παράδειγμα χρήσης \lib{spaCy}}\label{lst:spacy}
\end{listing}

\ig[type=pdf,inc={width=\linewidth}]{spacy-pipeline}{\lcaption{Η σωλήνωση λογισμικού που χρησιμοποιεί το \lib{spaCy} ως προεπιλογή}{
        Το \lib{spaCy} πρώτα κατατέμνει (\en{Tokenizer}) το κείμενο για να δημιουργήσει ένα αντικείμενο εγγράφου \python{Doc}.
        Το \python{Doc} στη συνέχεια υποβάλλεται σε επεξεργασία σε πολλά διαφορετικά βήματα μέσω μιας σωλήνωσης λογισμικού --- αναφέρεται ως \newtermprint[Processing Pipeline]{σωλήνωση επεξεργασίας}.
        Η προεπιλεγμένη σωλήνωση που χρησιμοποιείται αποτελείται από
        έναν \newtermprint[Tagger]{επισημαντή} μερών του λόγου,
        έναν \newtermprint[Parser]{αναλυτή} που αναθέτει τις σχέσεις εξάρτησης μεταξύ των λεκτικών μονάδων
        και ένα μοντέλο \newtermprint[Entity Recognizer]{αναγνώρισης οντοτήτων}.
        Κάθε στοιχείο σωλήνωσης επιστρέφει το επεξεργασμένο \lib{Doc}, το οποίο στη συνέχεια μεταβιβάζεται στο επόμενο στοιχείο.

        Στη θέση των αποσιωπητικών (\ldots{}) μπορούν να χρησιμοποιηθούν επεκτάσεις που προγραμματίζονται από τον χρήστη ή τρίτους.

        Από \url{https://spacy.io/usage/processing-pipelines}.%
    }%
}
\ig[type=pdf,inc={width=\linewidth}]{spacy-architecture}{\lcaption{Σύνοψη της αρχιτεκτονικής του \lib{spaCy}}{Από \url{https://spacy.io/api}.}}

\subsubsection{Κατάτμηση}
Κατά τη διάρκεια της επεξεργασίας, το \lib{spaCy} πρώτα κατατέμνει (\en{Tokenization}) το κείμενο σε λεκτικές μονάδες (\en{Token}),
δηλαδή το χωρίζει σε λέξεις, σημεία στίξης και ούτω καθεξής.
Αυτό γίνεται με την εφαρμογή ειδικών κανόνων για κάθε γλώσσα.
Για παράδειγμα, η στίξη στο τέλος μιας πρότασης θα πρέπει να διαχωριστεί ενώ το ακρωνύμιο \enquote{Η.Π.Α.} θα πρέπει να παραμείνει ενιαία μονάδα.
Κάθε \lib{Doc} αποτελείται από μια συλλογή λεκτικών μονάδων και ο προγραμματιστής μπορεί να τις προσπελάσει σειριακά ή άμεσα με τον δείκτη της μονάδας.

\subsubsection{Επισήμανση}
Μετά την κατάτμηση του κειμένου, το \lib{spaCy} μπορεί να αναλύσει ένα συγκεκριμένο \lib{Doc} και να το επισημάνει με ετικέτες.
Σ' αυτό το σημείο είναι απαραίτητο το στατιστικό μοντέλο, το οποίο επιτρέπει στο \lib{spaCy} να κάνει μια πρόβλεψη για το ποια ετικέτα χρειάζεται σύμφωνα με τα συμφραζόμενα,
για παράδειγμα, η λέξη που ακολουθεί το \engquote{the} στα αγγλικά είναι κατά πάσα πιθανότητα ουσιαστικό.

\subsubsection{Διαχωρισμός προτάσεων στο κείμενο}\label{subsec:4-sents}
Η \newterm{Αποσαφήνιση Ορίων Πρότασης}{Sentence Boundary Disambiguation - SBD} αναφέρεται στο πρόβλημα της εύρεσης και τμηματοποίησης μεμονωμένων προτάσεων.
Στο \lib{spaCy}, τα όρια των προτάσεων υπολογίζονται από το \newtermprint[Syntactic Parse Tree]{συντακτικό δέντρο ανάλυσης},
έτσι ώστε χαρακτηριστικά όπως η στίξη και η κεφαλαιοποίηση να παίζουν σημαντικό αλλά όχι θεμελιώδη ρόλο στον καθορισμό των ορίων της πρότασης.
Συνήθως, αυτό σημαίνει ότι τα όρια της κύριας πρότασης θα συμπίπτουν τουλάχιστον με τα όρια της δευτερεύουσας πρότασης, ακόμη και σε κείμενο με κακή στίξη.

Στο \projectname{} αξιοποιείται αυτός ο διαχωρισμός και πολλές διεργασίες γίνονται μόνο στο πλαίσιο της πρότασης.
Συγκεκριμένα, η ανάθεση σημασιολογικών ρόλων, η εξαγωγή προθέσεων και οντοτήτων και συνεπώς άλλες επόμενες μονάδες υποθέτουν την επεξεργασία κειμένου που περιέχει μόνο μια πρόταση.
Αυτό αποσκοπεί στη βελτίωση της απόδοσης και τη μείωση της πολυπλοκότητας.

Ωστόσο, άλλες διεργασίες πραγματοποιούνται στο σύνολο του κειμένου εισόδου.
Η εύρεση συναναφορών πρέπει να γίνεται σε όλο το κείμενο έτσι ώστε να βρίσκονται συναναφορές στο σύνολό του.
Η επισήμανση και αντικατάσταση παραθέσεων γίνεται επίσης στο σύνολο του κειμένου για να μην επηρεάζεται το μοντέλο συναναφορών
και για να μην γίνεται η ανάλυση του κειμένου που περιλαμβάνεται σε αυτές από το \lib{spaCy}.

\subsection{Επισήμανση συναναφορών}\label{subsec:4-coref-resolution}
Κύριος σκοπός της επισήμανσης συναναφορών στο \projectname{} είναι η ανίχνευση αντωνυμιών και η αντικατάστασή τους με την κύρια αναφορά.
Αυτό βοηθάει στην καλύτερη ανίχνευση των προθέσεων και των οντοτήτων στη μονάδα NLU (βλέπε \fref{subsec:4-NLU}).
Επειδή τα δεδομένα δεν περιλαμβάνουν παραδείγματα που περιέχουν αντωνυμίες,
η επίλυση των αναφορών βελτιώνει την απόδοση των μοντέλων καθώς η νέα είσοδος σε αυτά είναι πιο κοντά στα δεδομένα πάνω στα οποία εκπαιδεύτηκαν.

Διερευνήθηκε η χρήση των βιβλιοθηκών \libcite[Python!]{neuralcoref}, \libcite{CoreNLP} και \libcite[Python!]{AllenNLP}.

\subsubsection{Neuralcoref}\label{subsec:4-neuralcoref}
Αν και το μοντέλο~\cite{lee2017end} του \lib{AllenNLP} είναι πιο σύγχρονο και αναφέρει καλύτερα αποτελέσματα,
προτιμήθηκε να χρησιμοποιηθεί το \lib{neuralcoref} ως βάση λόγω εμπειρικών αποτελεσμάτων στο σύνολο δεδομένων.

Το \lib{neuralcoref} υλοποιήθηκε ως επέκταση της \lib{spaCy}.
Προσθέτει νέες ιδιότητες στα αντικείμενα της \lib{spaCy} που αντιπροσωπεύουν λεκτικά δείγματα (\python{Token}), διαστήματα (\python{Span}) και έγγραφα (\python{Doc}).
Η λειτουργία του βασίζεται στη δημιουργία \newtermprint[Cluster]{συμπλεγμάτων}.
Κάθε σύμπλεγμα αντιπροσωπεύει μια οντότητα που εμφανίζεται στο κείμενο.
Το στοιχείο \python{Cluster.main} είναι το διάστημα της πιο αντιπροσωπευτικής αναφοράς της οντότητας
ενώ η λίστα \python{Cluster.mentions} περιέχει τις υπόλοιπες αναφορές που βρίσκονται στο κείμενο.
Η λίστα των συμπλεγμάτων του κειμένου είναι προσβάσιμη από τα πεδία των αντικειμένων της \lib{spaCy}, για παράδειγμα \python{Doc._.coref_clusters}.

\begin{listing}
    \begin{minted}{python}
>>> import spacy
>>> import neuralcoref
>>> nlp = spacy.load("en_core_web_sm")
>>> neuralcoref.add_to_pipe(nlp)
>>> doc = nlp("My sister has a dog. She loves him")
>>> [t.text for t in doc.sents]
['My sister has a dog.', 'She loves him']
>>> doc._.coref_clusters
[My sister: [My sister, She], a dog: [a dog, him]]
>>> doc._.coref_clusters[1].mentions
[a dog, him]
>>> doc[-1]
him
>>> doc[-1]._.coref_clusters
[a dog: [a dog, him]]
\end{minted}
    \caption{Παράδειγμα χρήσης \lib{neuralcoref}}
\end{listing}

\subsubsection{CorefAnnotator}\label{subsec:4-CorefAnnotator}
Καθώς η επισήμανση συναναφορών αποτελεί δύσκολη διεργασία που μπορεί να αποτύχει σε πολλές περιπτώσεις,
γίνεται και η χρήση του \lib{CorefAnnotator}\footnote{\url{https://stanfordnlp.github.io/CoreNLP/coref.html}} (υπομνηματιστής συναναφορών) του \lib{CoreNLP}.
Προσφέρονται τρεις προσεγγίσεις: μια ντετερμινιστική~\cite{CorefAnnotatorD1,CorefAnnotatorD2,CorefAnnotatorD3}, μια στατιστική~\cite{CorefAnnotatorS} και μια με νευρωνικά δίκτυα~\cite{CorefAnnotatorN1,CorefAnnotatorN2}.
Γίνεται μόνο η χρήση του στατιστικού μοντέλου, το οποίο είναι και το γρηγορότερο σύμφωνα με τις μετρήσεις του \en{Stanford},
αφού η χρήση των τριών διαφορετικών σωληνώσεων που θα απαιτούνταν για τον συνδυασμό όλων των προσεγγίσεων θα ήταν υπολογιστικά χρονοβόρα.
% TODO: code

\subsubsection{Συνδυασμός}\label{subsec:4-coref-combine}
Για την πρόσβαση στις συναναφορές με μια κοινή διεπαφή από τα υπόλοιπα μέρη του συστήματος, γίνεται συγχώνευση των συμπλεγμάτων αναφορών που εξάγονται από τις δύο βιβλιοθήκες.
Χρησιμοποιείται μια προσέγγιση παρόμοια με αυτή που ακολουθεί το \lib{neuralcoref}, δηλαδή οι συναναφορές ενσωματώνονται στα αντικείμενα που χρησιμοποιεί το \lib{spaCy}.

Αντί να χρησιμοποιούνται μέθοδοι εσωτερικές στον κώδικα του \lib{neuralcoref} για τη δημιουργία συμπλεγμάτων,
η τρέχουσα μονάδα απομιμείται τη λειτουργικότητα των διεπαφών του \lib{neuralcoref} που χρησιμοποιούνται και σε άλλα σημεία του κώδικα του \projectname{}.
Κάθε αναφορά που εξάγεται από τον \lib{CorefAnnotator} προστίθεται στις λίστες \python{coref_clusters} των \python{Doc} και \python{Token} αν δεν υπάρχει ήδη.

\subsection{Ανάθεση σημασιολογικών ρόλων}\label{subsec:4-allenSRL}
Για τη διαδικασία της ανάθεσης σημασιολογικών ρόλων χρησιμοποιείται το αντίστοιχο μοντέλο~\cite{he2017deep} της βιβλιοθήκης \libcite[Python!]{AllenNLP}.
Εδώ, η βιβλιοθήκη χρησιμοποιεί ως βάση το \lib{spaCy} για τον κατακερματισμό σε μονάδες και την επισημείωση μερών του λόγου.
Κάθε λεκτική μονάδα που είναι ρήμα χρησιμοποιείται ως κατηγόρημα και η υπόλοιπη δομή εξάγεται μέσω του εκπαιδευμένου μοντέλου.
Αυτό αποτελεί έναν σημαντικό περιορισμό καθώς δε γίνεται σωστή ανίχνευση βοηθητικών ρημάτων.
Στην \fref{lst:srl} παρουσιάζεται μια ενδεικτική έξοδος του μοντέλου καθώς και ένα πιθανό πρόβλημα με τα βοηθητικά ρήματα.

\begin{listing}
    \begin{minted}{python}
>>> from allennlp.predictors.predictor import Predictor
>>> predictor = Predictor.from_path(
...     "https://s3-us-west-2.amazonaws.com/allennlp/"
...     "models/srl-model-2018.05.25.tar.gz"
... )
>>> [
...     verb["description"]
...     for verb in predictor.predict(
...         "The keys, which were needed to access the building, were locked in the car."
...     )["verbs"]
... ]
['The keys , which [V: were] needed to access the building , were locked in the car .',
 '[ARG1: The keys] , [R-ARG1: which] were [V: needed] [ARGM-PRP: to access the building] , were locked in the car .',
 'The keys , which were needed to [V: access] [ARG1: the building] , were locked in the car .',
 'The keys , which were needed to access the building , [V: were] locked in the car .',
 '[ARG1: The keys , which were needed to access the building ,] were [V: locked] [ARGM-LOC: in the car] .']
\end{minted}
    \lcaption{Παράδειγμα εξόδου SRL του μοντέλου του \lib{AllenNLP}}{%
        Παρατηρούμε ότι για τα δύο βοηθητικά ρήματα \engquote{were} δημιουργείται ξεχωριστή καταχώρηση
        αντί να συγχωνεύονται με τις εκφράσεις \engquote{were needed} και \engquote{were locked}.%
    }\label{lst:srl}
\end{listing}

Καθώς πρόκειται για μοντέλο με αρκετές παραμέτρους, η φόρτωσή του στη μνήμη και η επαγωγή του αποτελέσματος έχει σημαντικό υπολογιστικό κόστος.
Για αυτό τον λόγο, χρησιμοποιείται ξεχωριστή διεργασία υπεύθυνη αποκλειστικά για αυτές τις διαδικασίες.
Το υπόλοιπο πρόγραμμα επικοινωνεί με τη διαδικασία μέσω δύο ουρών (\python{Queue} από \python{multiprocessing}).
Η μία χρησιμοποιείται για να στείλει την πρόταση στην οποία θα γίνει η ανάλυση, χωρίς να χρειάζεται να περιμένει ο αποστολέας και από τη δεύτερη λαμβάνεται η έξοδος του μοντέλου όταν αυτή είναι έτοιμη.
Σημειώνεται ότι απαιτείται \newtermprint[Process]{διεργασία} και όχι απλό \newtermprint[Thread]{νήμα}
λόγω του \newterm[Python]{Καθολικ\rr{ού}{ό} \rr{κλειδώματος}{Κλείδωμα} Διερμηνέα}{Global Interpreter Lock - GIL} της \en{Python} που επιτρέπει την εκτέλεση ενός και μόνου νήματος σε κάθε χρονική στιγμή.
Δηλαδή, δεν υπάρχουν πλεονεκτήματα στον χρόνο εκτέλεσης λόγω παραλληλισμού εκτός και αν χρησιμοποιηθεί ξεχωριστή διεργασία.

Η διαδικασία της ανάθεσης σημασιολογικών ρόλων χρησιμοποιείται για τη δημιουργία υποπροτάσεων (\fref{subsec:4-subsentences}) και το σκεπτικό αυτό αιτιολογείται στη συνέχεια.

\subsection{Υποπροτάσεις}\label{subsec:4-subsentences}
Χρησιμοποιείται ο όρος \newtermprint[Subsentence]{Υποπρόταση} για να περιγράψει ένα οποιοδήποτε υποσύνολο λεκτικών μονάδων μιας πρότασης.
Σκοπός των υποπροτάσεων στο \projectname{} είναι η ανεύρεση πολλαπλών προθέσεων του χρήστη σε κάθε πρόταση (βλέπε και \fref{subsec:multi-intent}).
Αυτό υλοποιείται με την εκμετάλλευση των αποτελεσμάτων της ανάλυσης σημασιολογικών ρόλων.

\subsubsection{Δημιουργία}\label{subsec:4-subsentence-create}
Κύρια ιδέα της υλοποίησης αποτελεί η αντιστοίχηση κάθε \newterm[Ανάθεση Σημασιολογικών Ρόλων - Semantic Role Labeling - SRL]{Δομή\dd{ς} Κατηγορήματος-Ορισμάτων}{Predicate-Argument Structure} με μια πιθανή πρόθεση του χρήστη.
Σε αντίθεση με τον διαχωρισμό σε συνεχόμενα υποσύνολα της πρότασης ή απλές προτάσεις (\en{Clause}),
η προσέγγιση αυτή επιτρέπει τη σωστή ανάλυση ακόμη και πιο δύσκολων συντακτικών δομών όπως της \newterm{Ανύψωση\dd{ς} Δεξιού Κόμβου}{Right Node Raising} (βλέπε και \fref{subsec:linguistics}).
Η διαδικασία που ακολουθείται είναι η εξής:
\begin{compactenum}
    \item Για κάθε ρήμα στην έξοδο του μοντέλου σημασιολογικών ρόλων (\fref{subsec:4-allenSRL}), δημιουργείται ένα αντικείμενο τύπου \python{SubSentence}
    \item Αποθηκεύονται οι θέσεις των ορισμάτων (\ARGs{}) και των τροποποιητών (\ARGM{})
    \item Γίνεται συσχετισμός των υποπροτάσεων μεταξύ τους
          \begin{compactenum}
              \item Υποπροτάσεις στις οποίες τα υποσύνολα των κατηγορημάτων και ορισμάτων δεν έχουν αλληλεπικάλυψη θεωρούνται \enquote{συμβατές}:
                    \begin{equation}
                        (\{ARG\}_1 \cup \{ARGM\}_1 ) \cap (\{ARG\}_2 \cup \{ARGM\}_2) = \varnothing
                    \end{equation}

                    Αυτή η διαδικασία καθίσταται απαραίτητη λόγω των αποτελεσμάτων της ανάθεσης σημασιολογικών ρόλων που μερικές φορές μπορεί να παρουσιάζει αντιφάσεις.
              \item Μια υποπρόταση θεωρείται ότι \enquote{τροποποιεί} μιαν άλλη αν το ρήμα της πρώτης βρίσκεται μέσα στο διάστημα των τροποποιητών (\ARGM{}) της δεύτερης.
                    Αυτές οι υποπροτάσεις θεωρούνται συμβατές εκτός και αν υπάρχει ο πρώτος τύπος αλληλεπικάλυψης.
          \end{compactenum}
\end{compactenum}

Για παράδειγμα, στην πρόταση \engquote{Open your left hand and then extend it while saying hello} δημιουργούνται τρεις υποπροτάσεις, όλες συμβατές μεταξύ τους,
από την έξοδο της ανάθεσης σημασιολογικών ρόλων:
\begin{compactenum}
    \item \en{[V: Open] [ARG1: your left hand] and then extend it while saying hello.}
    \item \en{Open your left hand and [ARGM-TMP: then] [V: extend] [ARG1: it] [ARGM-TMP: while saying hello].}
    \item \en{Open your left hand and then extend it while [V: saying] [ARG1: hello].}
\end{compactenum}
Όπως είναι φανερό, καθεμία από αυτές αντιστοιχεί σε μια ξεχωριστή πρόθεση χρήστη.

Τέτοιες προσεγγίσεις δεν συναντώνται στη βιβλιογραφία --- τουλάχιστον σε αυτές που βρέθηκαν κατά τη διάρκεια της έρευνας για την παρούσα διπλωματική.
Οι πιο σχετικές μέθοδοι που συναντήθηκαν είναι αυτές που αντιστοιχίζουν κάθε δομή κατηγορήματος-ορίσματος σε κάποια πρόθεση του συστήματος~\cite{tur2005semi,hakkani2015clustering}
(γίνεται αναφορά και στην \fref{subsec:intents-and-entities})
και στο~\cite{diamantopoulos2017software} όπου χρησιμοποιείται η ανάθεση σημασιολογικών ρόλων για την ανάλυση λειτουργικών απαιτήσεων λογισμικού και η αντιστοίχησή τους σε μια οντολογία.

\subsubsection{Συνδυασμός}\label{subsec:4-subsentence-combine}
Μετά τη διαδικασία δημιουργίας τους, οι υποπροτάσεις συνδυάζονται σε δομές.
Κάθε συνδυασμός αποτελεί μια υπόθεση του διαχωρισμού της πρότασης σε προθέσεις και οντότητες.
Ακολουθείται η εξής διαδικασία:
\begin{compactenum}
    \item Η δημιουργία των συνδυασμών γίνεται στο δυναμοσύνολο\footnote{\newtermc{Δυναμοσύνολο}{Power Set} $P(X)$ ενός συνόλου $X$ είναι το σύνολο όλων των υποσυνόλων του $P(X) = \{A: A \subseteq X\}$}
          όλων των υποπροτάσεων που δημιουργήθηκαν
    \item Επιλέγεται ένας συνδυασμός με τα εξής κριτήρια:
          \begin{compactenum}
              \item αρχίζοντας από αυτούς που περιέχουν μεγαλύτερο αριθμό υποπροτάσεων
              \item αν δεν έχουν χρησιμοποιηθεί όλες οι υποπροτάσεις σε κάποιον προηγούμενο συνδυασμό,
              \item αν όλες οι υποπροτάσεις του συνδυασμού είναι συμβατές μεταξύ τους
          \end{compactenum}
    \item Η διαδικασία σταματάει όταν έχουν χρησιμοποιηθεί όλες οι υποπροτάσεις σε κάποιον συνδυασμό
\end{compactenum}

\subsection{Επιλογή κειμένου υποπρότασης}\label{subsec:4-powerset}
Στόχος αυτού του βήματος είναι η επιλογή του τελικού κειμένου μιας υποπρότασης σύμφωνα με την έξοδο της μονάδας NLU.
Οι πιθανές επιλογές γίνονται στα δυναμοσύνολα συνδυασμών τροποποιητών και συναναφορών.
Επιλέγεται αυτή που παρουσιάζει τη μεγαλύτερη αξιολόγηση στην έξοδο της μονάδας NLU.

\subsubsection{Τροποποιητές}
Κύριο κορμό του κειμένου, που περιλαμβάνεται σε κάθε εκδοχή του, αποτελεί το κατηγόρημα και τα ορίσματά του \ARGs{}.
Οι τροποποιητές \ARGM{} που θα περιληφθούν σε κάθε έκδοση του κειμένου επιλέγονται μέσα από το δυναμοσύνολο όλων των τροποποιητών που δεν ανήκουν σε κάποια άλλη υποπρόταση του ίδιου συνδυασμού με την τρέχουσα υποπρόταση.
Για παράδειγμα, στην υποπρόταση που δημιουργήθηκε από την εξής δομή κατηγορήματος-ορισμάτων
\engquote{Open your left hand and [ARGM-TMP: then] [V: move] [ARGM-DIR: forwards] [ARGM-TMP: while saying hello]}
το βασικό κείμενο είναι μόνο το ρήμα \engquote{[V: move]}
και το σύνολο των τροποποιητών είναι:
\begin{compactenum}
    \item \en{[ARGM-TMP: then]}
    \item \en{[ARGM-DIR: forwards]}
    \item \en{[ARGM-TMP: while saying hello]}
\end{compactenum}
Ο τελευταίος όμως θα ανήκει σε ξεχωριστή υποπρόταση του ίδιου συνδυασμού καθώς περιλαμβάνει το ρήμα \engquote{saying}
οπότε οι πιθανές επιλογές που θα αξιολογηθούν είναι:\\
\begin{tabulary}{\linewidth}{L @{ --- } L}
    \en{then move forwards} & επιλέγονται όλοι οι τροποποιητές    \\
    \en{then move}          & επιλέγεται μόνο ο πρώτος            \\
    \en{move forwards}      & επιλέγεται μόνο ο δεύτερος          \\
    \en{move}               & δεν επιλέγεται κανένας τροποποιητής
\end{tabulary}

\subsubsection{Συναναφορές}
Επιπλέον, για καθεμία από τις προηγούμενες επιλογές, επιλέγονται και οι συναναφορές οι οποίες θα αντικατασταθούν με το κείμενο της κύριας αναφοράς τους.
Για παράδειγμα, στην υποπρόταση
\engquote{Open your left hand and [ARGM-TMP: then] [V: extend] [ARG1: it] [ARGM-TMP: while saying hello].}
ο κύριος κορμός είναι τα \engquote{[V: extend] [ARG1: it]} όπου το \engquote{it} αναφέρεται στο \engquote{your left hand}.
Συμπεριλαμβανόμενης της διαδικασίας επιλογής τροποποιητών, όλες οι πιθανές επιλογές του τελικού κειμένου της υποπρότασης προκύπτουν:
\begin{compactenum}
    \item{then extend it}
    \item{then extend your left hand}
    \item{extend it}
    \item{extend your left hand}
\end{compactenum}

\subsection{Κατανόηση φυσικής γλώσσας}\label{subsec:4-NLU}
Η διαδικασία κατανόησης φυσικής γλώσσας γίνεται σε επίπεδο υποπρότασης καθώς δε χρησιμοποιούνται μοντέλα μηχανικής εκμάθησης που να επιτρέπουν την ταξινόμηση πολλών ετικετών (\en{Multi-Label Classification}).
Η αναγνώριση της πρόθεσης του χρήστη και η εξαγωγή οντοτήτων γίνεται πάνω σε καθεμία από τις επιλογές τελικού κειμένου που αναφέρθηκαν προηγουμένως (\fref{subsec:4-powerset}).
Για κάθε υποπρόταση, επιλέγεται το κείμενο που παρουσιάζει μεγαλύτερη βαθμολογία στην έξοδο της μονάδας NLU.

Κατά την ανάλυση του κειμένου πραγματοποιείται επίσης μια διαδικασία \newterm{Λημματοποίηση\dd{ς}}{Lemmatization} των ρημάτων.
Η λημματοποίηση αποτελεί τη διαδικασία της αντιστοίχισης κάθε επιμέρους γλωσσικού τύπου με το λήμμα στο οποίο ανήκει.
Αυτό στοχεύει στη βελτίωση της απόδοσης σε προτάσεις που χρησιμοποιούν ρήματα σε κλίσεις που δεν συναντώνται στα δεδομένα εκπαίδευσης.
Η διαδικασία γίνεται με τη βοήθεια του \libcite[Python!]{spaCy}.

\subsubsection{Snips}\label{subsec:4-snips}
Η βιβλιοθήκη \libcite[Python!]{Snips} που χρησιμοποιήθηκε ως βασικό μοντέλο πραγματοποιεί την αναγνώριση προθέσεων και την πλήρωση των σημασιολογικών υποδοχέων.
Το μοντέλο της βιβλιοθήκης αρχικά εκπαιδεύεται στο σύνολο δεδομένων.

Ένα από τα πλεονεκτήματα της βιβλιοθήκης σε σχέση με αντίστοιχες είναι η υποστήριξη \newterm{Αυτόματα Επεκτάσιμων Οντοτήτων}{Automatically Extensible Entities}\footnote{%
    \breakurl{https://snips-nlu.readthedocs.io/en/latest/data_model.html\#automatically-extensible-entities}%
}.
Αυτές μπορούν να χρησιμοποιηθούν ώστε συγκεκριμένες οντότητες να μπορούν να πάρουν τιμές που δεν συναντώνται στα δεδομένα εκπαίδευσης.
Για παράδειγμα, στην πρόθεση \intentr{Talk}, η οντότητα του κειμένου \entity{Text} θα μπορούσε να πάρει οποιαδήποτε τιμή χρησιμοποιήσει ο χρήστης.

Παρά τη δυνατότητα των επεκτάσιμων οντοτήτων, μερικές φορές είναι επιθυμητή η ύπαρξη κάποιας ελευθερίας στον προσδιορισμό των οντοτήτων αλλά και η ταυτόχρονη ύπαρξη περιορισμών.
Για παράδειγμα, στην πρόθεση \intentr{ArmMotion}, η οντότητα \entity{armMotion} (ο τύπος της κίνησης) μπορεί να πάρει τις προκαθορισμένες τιμές \entity{OFFER}, \entity{UP}, \entity{WAVE}, \ldots{} αλλά πρέπει να υποστηρίζει και πιο γενικές εκφράσεις και συνώνυμα.
Έτσι δημιουργούνται διαφορετικές προθέσεις για κάθε πιθανή τιμή της \entity{armMotion}:
\begin{compactenum}
    \item \intent{ArmMotionOffer}
    \item \intent{ArmMotionUp}
    \item \intent{ArmMotionWave}
    \item \intent{ArmMotionExtend}
    \item \intent{ArmMotionOpen}
    \item \intent{ArmMotionClose}
\end{compactenum}
οι οποίες, όταν ανιχνεύονται, μεταφράζονται στην πρόθεση \intentr{ArmMotion} με την αντίστοιχη τιμή της οντότητας \entity{armMotion}.

Επιπλέον, η βιβλιοθήκη υποστηρίζει την εξαγωγή οντοτήτων σε κείμενο ξεχωριστά από τη διαδικασία αναγνώρισης πρόθεσης.
Οπότε, μπορεί να χρησιμοποιηθεί κάποιο μοντέλο ταξινόμησης ακολουθιών για την πρόθεση και μετά, ανεξάρτητα, να χρησιμοποιηθεί η δυνατότητα εξαγωγής οντοτήτων του \lib{Snips} σύμφωνα με την αναγνωρισμένη πρόθεση.

\begin{code}
    \begin{minted}{python}
>>> from snips_nlu import SnipsNLUEngine
>>> nlu = SnipsNLUEngine.from_path("/path/to/dir")
>>> nlu("move forwards")
{'input': 'move forwards',
 'intent': {'intentName': 'BodyMotionForwards', 'probability': 1.0},
 'slots': []}
>>> nlu("raise your left hand")
{'input': 'raise your left hand',
 'intent': {'intentName': 'ArmMotionUp', 'probability': 0.8186328266611467},
 'slots': [{'range': {'start': 11, 'end': 15},
   'rawValue': 'left',
   'value': {'kind': 'Custom', 'value': 'LEFT'},
   'entity': 'Arm',
   'slotName': 'arm'}]}
    \end{minted}
    \caption{Παράδειγμα χρήσης εκπαιδευμένου μοντέλου \lib{Snips}}

    \begin{minted}{python}
>>> from r4a_nao_nlp.engines import shared
>> shared.init()
>>> shared.parse("move forwards")
SnipsResult(score=1.0, name='BodyMotion', slots=(SnipsSlot(range=range(-1, -1), value='FORWARDS', entity='Direction', name='direction'),))
>>> shared.parse("raise your left hand")
SnipsResult(score=0.8186328266611467, name='ArmMotion', slots=(SnipsSlot(range=range(-1, -1), value='UP', entity='ArmMotionType', name='armMotion'), SnipsSlot(range=range(11, 15), value='LEFT', entity='Arm', name='arm')))
    \end{minted}
    \caption{Παράδειγμα χρήσης του μοντέλου μαζί με το σύστημα μετάφρασης και τη χρήση βοηθητικών αντικειμένων \python{SnipsResult} και \python{SnipsSlot}}
\end{code}

\subsubsection{Αξιολόγηση συνδυασμών}\label{subsec:4-score}
Αφού επιλεχθούν τα τελικά κείμενα όλων των υποπροτάσεών τους, οι συνδυασμοί αξιολογούνται σύμφωνα με τις τελικές τους αξιολογήσεις.
Χρησιμοποιείται απλώς ο μέσος όρος όλων των αξιολογήσεων των υποπροτάσεων για την τελική αξιολόγηση.
Άλλες επιλογές θα αποτελούσαν η ελάχιστη τιμή όλων των αξιολογήσεων ή το γινόμενό τους.
Από όλους τους συνδυασμούς που έχουν δημιουργηθεί, επιλέγεται αυτός με τη μεγαλύτερη αξιολόγηση.

\subsection{Δημιουργία κατευθυνόμενου γράφου}\label{subsec:4-DiGraph}
Σε αυτό το βήμα, το \projectname{} δημιουργεί έναν κατευθυνόμενο γράφο που αναπαριστά τον επιλεγμένο συνδυασμό.
Αυτός επεκτείνεται με κάθε πρόταση του κειμένου και μπορεί να χρησιμοποιηθεί για την προγραμματιστική πρόσβαση στις υποπροτάσεις, τις μεταξύ τους σχέσεις και τις προθέσεις και οντότητες που έχουν ανιχνευθεί στο κείμενο εισόδου.

Για τη διαδικασία αυτή, επιλέχθηκε το \libcite[Python!]{networkx} λόγω της απλότητας στη χρήση, την υποστήριξη δημιουργίας γραφημάτων από γράφους και τις καλές του επιδόσεις.

Στον γράφο, κάθε υποπρόταση αποτελεί έναν κόμβο.
Οι λεκτικές μονάδες που δεν χρησιμοποιούνται σε καμία υποπρόταση χρησιμοποιούνται ως ετικέτες των ακμών που συνδέουν διαδοχικές υποπροτάσεις.
Η κατεύθυνση των υποπροτάσεων καθορίζεται από τη θέση του ρήματος στο αρχικό κείμενο.

Οι υποπροτάσεις που λειτουργούν ως τροποποιητές ενώνονται με τις υποπροτάσεις που τροποποιούν
και οι ακμές που τις ενώνουν έχουν ως ετικέτα τους τροποποιητές \ARGM{} που δεν έχουν χρησιμοποιηθεί κατά τη διαδικασία ανάλυσης προθέσεων.
Για παράδειγμα, αν έχουμε τις εξής υποπροτάσεις:
\begin{compactenum}
    \item \en{[V: Extend] [ARG1: both of your hands] [ARGM-TMP: while moving forwards]}
    \item \en{Extend both of your hands while [V: moving] [ARGM-DIR: forwards]}
\end{compactenum}
Η δεύτερη τροποποιεί την πρώτη.
Η ακμή που τις ενώνει θα έχει ως ετικέτα τη λέξη \engquote{while} καθώς βρίσκεται στους τροποποιητές της δομής κατηγορήματος-ορισμάτων του \engquote{extend} αλλά όχι στα ορίσματα του \engquote{moving}.

\subsubsection{Μορφοποίηση εξόδου}\label{subsec:4-format}
Πέρα από την απευθείας χρήση του αντικείμενου του γράφου μπορούν να χρησιμοποιηθούν άλλοι τρόπου μορφοποίησης της εξόδου οι οποίοι μπορούν να προκύψουν από τη δομή του γράφου.
Μια δομημένη λεκτική περιγραφή μπορεί να αξιοποιηθεί από ένα άλλο σύστημα για την αυτόματη δημιουργία του κώδικα της ρομποτικής εφαρμογής.

% vim:ts=4:sw=4:expandtab:fo-=tc:tw=120
